
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spectral Leakage &#8212; Climate and Geophysical Data Analysis</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://kls2177.github.io/Climate-and-Geophysical-Data-Analysis/chapters/index.html/chapters/Week6/leak.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Convolution and Filtering in the Time Domain" href="convolution_filters_in_time.html" />
    <link rel="prev" title="Continuous Power Spectrum and the Significance of Spectral Peaks" href="filtering_in_freq3.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://kls2177.github.io/Climate-and-Geophysical-Data-Analysis/chapters/index.html/chapters/Week6/leak.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Spectral Leakage" />
<meta property="og:description" content="Spectral Leakage  Two key problems arise when conducting spectral analysis of finite, discrete time series (not an infinite time series):  Aliasing: we only res" />
<meta property="og:image"       content="https://kls2177.github.io/Climate-and-Geophysical-Data-Analysis/chapters/index.html/_static/gistemp.png" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/gistemp.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Climate and Geophysical Data Analysis</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Climate and Geophysical Data Analysis
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction/intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week1a/whatarestatsgoodfor.html">
   What are statistics good for?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week1b/descriptivestats.html">
   Descriptive Statistics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week2/hypothesis_testing.html">
   Statistical Hypothesis Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week3/linreg.html">
   Linear Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week4/corr.html">
   Correlation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week5/persistence.html">
   Persistence in Time Series
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="reference internal" href="filt.html">
   Time Series Analysis
  </a>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="filtering_in_time.html">
     Filtering in the Time Domain: Part I
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Harmonics.html">
     Filtering in the Time Domain: Part II
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="filtering_in_freq1.html">
     Filtering in the Frequency Domain: Discrete Fourier Transform
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="filtering_in_freq2.html">
     Fast Fourier Transform
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="filtering_in_freq3.html">
     Continuous Power Spectrum and the Significance of Spectral Peaks
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Spectral Leakage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="convolution_filters_in_time.html">
     Convolution and Filtering in the Time Domain
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week7/pca.html">
   Patterns in Multivariate Data
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/chapters/Week6/leak.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/kls2177/Climate-and-Geophysical-Data-Analysis/master?urlpath=tree/chapters/Week6/leak.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/kls2177/Climate-and-Geophysical-Data-Analysis/blob/master/chapters/Week6/leak.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-the-problem">
   Setting up the problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convolution">
   Convolution
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#response-functions">
   Response Functions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characteristics-of-the-boxcar-window-response-function">
     Characteristics of the Boxcar Window Response Function:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#alternative-windows-for-minimizing-spectral-leakage">
   Alternative Windows for Minimizing Spectral Leakage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#windows-and-degress-of-freedom">
     Windows and Degress of Freedom
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#welch-s-overlapping-segment-analysis-method">
   Welch’s Overlapping Segment Analysis Method
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="spectral-leakage">
<h1>Spectral Leakage<a class="headerlink" href="#spectral-leakage" title="Permalink to this headline">¶</a></h1>
<p>Two key problems arise when conducting spectral analysis of finite, discrete time series (not an infinite time series):</p>
<ol class="simple">
<li><p><strong>Aliasing:</strong> we only resolve frequencies lower than the Nyquist frequency (<span class="math notranslate nohighlight">\(\frac{1}{2\Delta t}\)</span>), and frequencies higher than this get aliased to lower frequencies.</p></li>
<li><p><strong>Spectral Leakage:</strong> we assume that all waveforms stop and start at <span class="math notranslate nohighlight">\(t\)</span> = 0 and <span class="math notranslate nohighlight">\(t\)</span> = <span class="math notranslate nohighlight">\(T\)</span>, but in the real world, many of these wave numbers may not complete a full integer number of cycles throughout the domain, causing spectral leakage to other wave numbers.</p></li>
</ol>
<p>In this section, we will address the second problem, <strong>spectral leakage</strong> and how to reduce it.</p>
<div class="section" id="setting-up-the-problem">
<h2>Setting up the problem<a class="headerlink" href="#setting-up-the-problem" title="Permalink to this headline">¶</a></h2>
<p>Suppose we have a time series, <span class="math notranslate nohighlight">\(y(t)\)</span>, that is defined on -<span class="math notranslate nohighlight">\(\infty \leq t \leq \infty\)</span>.</p>
<p>Another way to conceptualize this time series would be to write it as, <span class="math notranslate nohighlight">\(y(t)g(t)\)</span>, where <span class="math notranslate nohighlight">\(g(t)\)</span> is a function with a value of 1 for all <span class="math notranslate nohighlight">\(t\)</span>, -<span class="math notranslate nohighlight">\(\infty \leq t \leq \infty\)</span>, as illustrated in the left panel in <a class="reference internal" href="#window"><span class="std std-ref">Figure 23</span></a>.</p>
<div class="figure align-default" id="window">
<a class="reference internal image-reference" href="../../_images/window.png"><img alt="../../_images/window.png" src="../../_images/window.png" style="width: 841.0px; height: 330.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 23 </span><span class="caption-text">Schematic comparing the window function of an infinite time series, with that of a finite time series</span><a class="headerlink" href="#window" title="Permalink to this image">¶</a></p>
</div>
<p>But what we really have is a time series, <span class="math notranslate nohighlight">\(y(t)\)</span>, that is defined a time interval from 0 <span class="math notranslate nohighlight">\(\leq t \leq T\)</span>. Applying the same conceptualization as above, we can denote this time series, <span class="math notranslate nohighlight">\(y(t)g(t)\)</span>, where now, <span class="math notranslate nohighlight">\(g(t)\)</span> now has a value of 1 over the range 0 <span class="math notranslate nohighlight">\(\leq t \leq T\)</span> and a value of zero for all other times, as illustrated in the right panel in <a class="reference internal" href="#window"><span class="std std-ref">Figure 23</span></a>.</p>
<p><span class="math notranslate nohighlight">\(g(t)\)</span> in the case of a finite time series can be thought of as a <em>window</em> and this window can act to cut-off incomplete cycles and cause spectral leakage. But what is spectral leakage, really? Let’s take a look at an example using a simple sine wave.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">sig</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s define a sine function on a time domain, such that the sine function completes <span class="math notranslate nohighlight">\(N\)</span>, integer cycles, i.e., no cycles are cut-off within the domain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define parameters</span>

<span class="c1"># length of time domain</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="c1"># time variable</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="c1"># frequency</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we can define and plot our sine function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define sine function</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot sine function</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Sine Wave&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Sine Wave&#39;)
</pre></div>
</div>
<img alt="../../_images/leak_6_1.png" src="../../_images/leak_6_1.png" />
</div>
</div>
<p>Here, we have 4 complete cycles of our sine wave. Now, let’s compute the discrete power spectrum of this sine wave.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute FFT</span>
<span class="n">yfft1_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">yfft1</span> <span class="o">=</span> <span class="n">yfft1_raw</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

<span class="c1"># compute variance as a function of frequency (spectral power)</span>
<span class="n">ck2y1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yfft1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>What do you think it will look like?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot normalized power as a function of frequency</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">ck2y1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.0025</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (cycles per time step)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Power&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Discrete Power Spectrum for Un-windowed Sine Wave&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Discrete Power Spectrum for Un-windowed Sine Wave&#39;)
</pre></div>
</div>
<img alt="../../_images/leak_10_1.png" src="../../_images/leak_10_1.png" />
</div>
</div>
<p>We get a single spectral peak corresponding to the frequency of our sine wave.</p>
<p>Now, let’s see what happens if we apply a <em>window</em> to our sine wave that cuts off the sine wave such that the sine function does not complete an integer number of cycles within the time domain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now let&#39;s window our data, such that we are not cleanly sampling our sine function</span>
<span class="n">y2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bxcr</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mf">6.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">):</span>
        <span class="n">y2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">bxcr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">bxcr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
<span class="n">bxcr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">bxcr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Above, we created a window function called <code class="docutils literal notranslate"><span class="pre">bxcr</span></code> (short for box-car) and our cut-off sine wave. Let’s plot these to see what they look like. Notice that if we multiply <code class="docutils literal notranslate"><span class="pre">bxcr</span></code> and our original sine wave together we get the modified sine wave.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot windowed sine wave, window</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">bxcr</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Windowed Sine Wave&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y1</span><span class="o">*</span><span class="n">bxcr</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Also a Windowed Sine Wave&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Also a Windowed Sine Wave&#39;)
</pre></div>
</div>
<img alt="../../_images/leak_14_1.png" src="../../_images/leak_14_1.png" />
</div>
</div>
<p>To demonstrate what spectral leakage is, we will now compute the discrete power spectrum of the windowed sine wave to see what happens.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute FFT</span>
<span class="n">yfft2_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
<span class="n">yfft2</span> <span class="o">=</span> <span class="n">yfft2_raw</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>

<span class="c1"># compute variance as a function of frequency (spectral power)</span>
<span class="n">ck2y2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yfft2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Power Spectrum of windowed data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">ck2y2</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.0025</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;power&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Discrete Power Spectrum for Windowed Sine Wave&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Discrete Power Spectrum for Windowed Sine Wave&#39;)
</pre></div>
</div>
<img alt="../../_images/leak_17_1.png" src="../../_images/leak_17_1.png" />
</div>
</div>
<p>What happened? Our Fourier Transform is not able to clearly isolate the sine wave frequency as the only frequency. This is the essense of spectral leakage and it is problematic because it can introduce frequencies in time series that are not actually there. In order to better understand how windowing can result in spectral leakage, we need learn a bit about <strong>convolution</strong>.</p>
</div>
<div class="section" id="convolution">
<h2>Convolution<a class="headerlink" href="#convolution" title="Permalink to this headline">¶</a></h2>
<p>We can minimize spectral leakage by applying different <em>windows</em> to our data, i.e., by creating different functional forms for <span class="math notranslate nohighlight">\(g(t)\)</span>. To understand how applying different windows can help, we first need to define something called <strong>convolution</strong>.</p>
<p>The convolution of two functions <span class="math notranslate nohighlight">\(y(t)\)</span> and <span class="math notranslate nohighlight">\(g(t)\)</span> is:</p>
<div class="math notranslate nohighlight">
\[
(g * y)(t) = \int_{-\infty}^{\infty} g(\tau)y(t-\tau) \,d\tau
\]</div>
<p>where the (<span class="math notranslate nohighlight">\(*\)</span>) symbol denotes a convolution. Let’s do an example to see what this equation is actually telling us (turns out it isn’t that complicated!).</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>Let <span class="math notranslate nohighlight">\(g(\tau)\)</span> = <span class="math notranslate nohighlight">\([\)</span>0 <span class="math notranslate nohighlight">\(\frac{1}{3}\)</span> <span class="math notranslate nohighlight">\(\frac{1}{3}\)</span> <span class="math notranslate nohighlight">\(\frac{1}{3}\)</span> 0<span class="math notranslate nohighlight">\(]\)</span> for <span class="math notranslate nohighlight">\(\tau\)</span> = -2, -1, 0, 1, 2</p>
<p>Let <span class="math notranslate nohighlight">\(y(t)\)</span> = <span class="math notranslate nohighlight">\([\)</span>9 7 8 6 5 4 3 8 9 10 11<span class="math notranslate nohighlight">\(]\)</span> for <span class="math notranslate nohighlight">\(t\)</span> = 1, 2, 3, 4,…</p>
<p>(<span class="math notranslate nohighlight">\(g * y\)</span>)(t = 4) = 7 · 0 + 8 · <span class="math notranslate nohighlight">\(\frac{1}{3}\)</span> + 6 · <span class="math notranslate nohighlight">\(\frac{1}{3}\)</span> + 5 · <span class="math notranslate nohighlight">\(\frac{1}{3}\)</span> + 4 · 0 = <span class="math notranslate nohighlight">\(\frac{19}{3}\)</span></p>
</div>
<p>Thus, the convolution is really just a <em>sliding window</em>, or, a <em>sliding weighted average</em>! <span class="math notranslate nohighlight">\(g(\tau)\)</span> could be any function, for example, the window in the right panel of <a class="reference internal" href="#window"><span class="std std-ref">Figure 23</span></a> above.</p>
<p>We have seen something similar to convolution in Assignment 2, <a class="reference external" href="https://www.youtube.com/watch?v=Ma0YONjMZLI"><strong>cross-correlation</strong></a>.</p>
<p>This brings us to the <strong>Convolution Theorem</strong></p>
<div class="note admonition">
<p class="admonition-title">Convolution Theorem</p>
<p>The convolution theorem tells us that the Fourier Transform of the product of two functions is the convolution of their individual Fourier Transforms (and vice versa).</p>
</div>
<p>Mathematically, we write,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\mathcal{F}(y(t)g(t)) &amp;= \mathcal{F}(y(t))*\mathcal{F}(g(t))\\
&amp; = \mathcal{Y}(\omega) * \mathcal{G}(\omega)
\end{align}
\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\mathcal{F}(y(t)*g(t)) &amp;= \mathcal{F}(y(t))\mathcal{F}(g(t))\\
&amp; = \mathcal{Y}(\omega)\mathcal{G}(\omega)
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{F}\)</span> is the Fourier Transform operator and fancy capital letters denote the Fourier Transform of their lower-case functions. And recall that,</p>
<div class="math notranslate nohighlight">
\[
y(t) = \frac{1}{2\pi}\int_{-\infty}^{\infty} Y(\omega)e^{i\omega t} \,d\omega
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
Y(\omega) = \int_{-\infty}^{\infty} y(t)e^{-i\omega t} \,dt
\]</div>
<p>Now, what does all this mean for spectral leakage? So, back to <a class="reference internal" href="#window"><span class="std std-ref">Figure 23</span></a>: if we have a finite time series, <span class="math notranslate nohighlight">\(y(t)\)</span>, when we take its Fourier Transform, what we are really doing is taking the Fourier Transform of <span class="math notranslate nohighlight">\(y(t)g(t)\)</span>! Cool! So, the Convolution Theorem then tells us that the Fourier Transform of <span class="math notranslate nohighlight">\(y(t)g(t)\)</span> is the convolution of the individual Fourier Transforms resulting in <strong>spectral leakage</strong>.</p>
<p>Mathematically, the Convolution Theorem tells us that if,</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
\mathcal{F}(y(t)g(t)) &amp;= \int_{-\infty}^{\infty} y(t)g(t)e^{-i\omega t} \,dt
\end{align}
\]</div>
<p>then,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\mathcal{F}(y(t)g(t)) &amp;= \mathcal{F}(y(t))*\mathcal{F}(g(t))\\
&amp; = \mathcal{Y}(\omega) * \mathcal{G}(\omega)\\
&amp; = \int_{-\infty}^{\infty} \mathcal{Y}(\omega_0)\mathcal{G}(\omega-\omega_0) \,d\omega_0
\end{align}
\end{split}\]</div>
<p>So, the Fourier Transform of our discrete and finite time series <span class="math notranslate nohighlight">\(y(t)\)</span> with window <span class="math notranslate nohighlight">\(g(t)\)</span> can be found by convolving the individual Fourier Transforms <span class="math notranslate nohighlight">\(\mathcal{Y}(\omega)\)</span> and <span class="math notranslate nohighlight">\(\mathcal{G}(\omega)\)</span>!</p>
<p>One way to think about this is that our infinite Fourier Transform <span class="math notranslate nohighlight">\(\mathcal{Y}(\omega)\)</span> gets smoothed out by a moving weighted average that looks like the Fourier Transform of <span class="math notranslate nohighlight">\(g(t)\)</span> (namely, <span class="math notranslate nohighlight">\(\mathcal{G}(\omega)\)</span>).</p>
<p>Let’s revisit the sine wave example above to see what this works. First, let’s compute the FFT of the window, <code class="docutils literal notranslate"><span class="pre">bxcr</span></code> and plot the power spectrum.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute FFT</span>
<span class="n">bfft_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">bxcr</span><span class="p">)</span>
<span class="n">bfft</span> <span class="o">=</span> <span class="n">bfft_raw</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bxcr</span><span class="p">)</span>

<span class="c1"># compute variance as a function of frequency (spectral power)</span>
<span class="n">ck2bxcr</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bfft</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Power spectrum of boxcar window</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">ck2bxcr</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.0025</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;power&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Discrete Power Spectrum for Boxcar Function&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Discrete Power Spectrum for Boxcar Function&#39;)
</pre></div>
</div>
<img alt="../../_images/leak_20_1.png" src="../../_images/leak_20_1.png" />
</div>
</div>
<p>We can test the convolution theorem, by convolving the two individual Fourier Transforms of <code class="docutils literal notranslate"><span class="pre">y1</span></code> and <code class="docutils literal notranslate"><span class="pre">bxcr</span></code> and see if we get the Fourier Transform of their product, <code class="docutils literal notranslate"><span class="pre">y2</span></code>. Note, that the <a class="reference external" href="http://greenteapress.com/thinkdsp/html/thinkdsp009.html">most efficient way to do this convolution in python and to avoid issues with zero-padding using the <code class="docutils literal notranslate"><span class="pre">np.convolve</span></code> function, etc.</a> is to apply the <a class="reference external" href="https://en.wikipedia.org/wiki/Convolution_theorem#Convolution_theorem_for_inverse_Fourier_transform">convolution Theorem for the Inverse Fourier Transform</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convolution of y1 and bxcr using inverse FFT</span>
<span class="n">cfft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">yfft1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">bfft</span><span class="p">))</span>

<span class="c1"># compute variance as a function of frequency (spectral power)</span>
<span class="n">ck2c</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cfft</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot thie discrete power spectrum. We should get something that looks like the discrete power spectrum for <code class="docutils literal notranslate"><span class="pre">y2</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">ck2c</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.0025</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;power&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Discrete Power Spectrum for Boxcar Function&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Discrete Power Spectrum for Boxcar Function&#39;)
</pre></div>
</div>
<img alt="../../_images/leak_24_1.png" src="../../_images/leak_24_1.png" />
</div>
</div>
<p>We see that we can recover the windowed discrete power spectrum of <code class="docutils literal notranslate"><span class="pre">y2</span></code> when we convolve the Fourier Transforms of the individual time series, <code class="docutils literal notranslate"><span class="pre">y1</span></code> and <code class="docutils literal notranslate"><span class="pre">bxcr</span></code>.</p>
</div>
<div class="section" id="response-functions">
<h2>Response Functions<a class="headerlink" href="#response-functions" title="Permalink to this headline">¶</a></h2>
<p>The function <span class="math notranslate nohighlight">\(\mathcal{G}(\omega-\omega_0)\)</span> is called the response function of window <span class="math notranslate nohighlight">\(g(t)\)</span> that acts on the original time series (where <span class="math notranslate nohighlight">\(g(t)\)</span> is a window in time, not in frequency).</p>
<p><em>Ideal Case (no window):</em></p>
<p>In an ideal world, we would like our window <span class="math notranslate nohighlight">\(g(t)\)</span> to give us a response function of <span class="math notranslate nohighlight">\(\mathcal{G}(\omega-\omega_0)\)</span> such that,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\mathcal{G}(\omega-\omega_0) &amp;= 1 \quad \text{when $\omega = \omega_0$}\\
\mathcal{G}(\omega-\omega_0) &amp;= 0 \quad \text{when $\omega \neq \omega_0$}\\
\end{align}
\end{split}\]</div>
<p>That is, a delta function at lag 0 (or, where <span class="math notranslate nohighlight">\(\omega=\omega_0\)</span>).</p>
<p><em>Boxcar Window</em>:</p>
<p>In reality, the response function for our discrete window is very different from this, for example, consider the naive window that we all automatically use when analyzing discrete data, i.e. the Boxcar Window:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
g(t) &amp;= 1 \quad \text{when $0 \leq t \leq T$}\\
g(t) &amp; = 0 \quad \text{for all other $t$}
\end{align}
\end{split}\]</div>
<p>The Fourier Transform of the Boxcar Function is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\mathcal{G}(\omega) &amp;= \frac{\text{sin}(\omega T/2)}{\omega T/2}\\
 &amp;= sinc(\omega T/2\pi)
\end{align}
\end{split}\]</div>
<p>where the normalized <span class="math notranslate nohighlight">\(sinc\)</span> function is defined as,</p>
<div class="math notranslate nohighlight">
\[
sinc(x) = \frac{\text{sin}(\pi x)}{\pi x}
\]</div>
<p>Let’s plot the <span class="math notranslate nohighlight">\(sinc\)</span> function and see what it looks like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Response function for boxcar window for different values of T</span>
<span class="n">bxcr_response</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">freq</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">102</span><span class="p">):</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="c1"># time variable</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="c1"># frequency</span>
    <span class="n">freq_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    
    <span class="n">bxcr_response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">freq_tmp</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
    <span class="n">freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq_tmp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot this response function as a function of frequency. Note that this is not a plot of power. This plot corresponds to the Fourier Transform of the boxcar window.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot response functions for different values of T</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">bxcr_response</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;T = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;$\pi$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fba4e8e4ee0&gt;
</pre></div>
</div>
<img alt="../../_images/leak_28_1.png" src="../../_images/leak_28_1.png" />
</div>
</div>
<p>Recall why we are looking at this: The Fourier Transform of a windowed time series corresponds to the convolution of the individual Fourier Transforms (convolution theorem!). Thus, the above plot shows the function that is being <em>convolved</em> with the pure periodic signal in our time series leading to spectral leakage. Remember that a convolution can be thought of as a sliding weighted average.</p>
<p>So, what do you see? The ideal response function, as described above, should just be a step function, i.e. it should have a value of 1 at lag = 0 (in this plot, <span class="math notranslate nohighlight">\(\omega\)</span> = 0) and a value of 0 everywhere else. This is not what we see for the boxcar window. We do see a value of 1 at lag = 0, but we see many other non-zero values at higher lags. Notice the large negative side lobe and their rather slow, oscillatory decay. We also see that as <span class="math notranslate nohighlight">\(T\)</span> gets larger, the boxcar function approaches a step function, but never truly gets there.</p>
<div class="section" id="characteristics-of-the-boxcar-window-response-function">
<h3>Characteristics of the Boxcar Window Response Function:<a class="headerlink" href="#characteristics-of-the-boxcar-window-response-function" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>smoothing:</strong> when the spectrum is calculated through a boxcar, the window acts to smooth and distort the true spectrum.</p></li>
<li><p><strong>side lobes:</strong> note the side lobes, these can be a real problem as they add frequencies to your spectrum that may not have been present in your original data - the reason for the side lobe is that these are the higher frequency harmonics needed to try and fit the sharp corners of the boxcar window.</p></li>
<li><p><strong>small T:</strong> note that for small T, the frequency window (response function) is much wider, and thus, there is more smoothing among the different frequencies.</p></li>
<li><p><strong>large T:</strong> for large T, the frequency window (response function) is more like a delta function, and becomes closer and closer to the ideal response function. For large T, this makes sense, because the edges of your “boxcar” are just a tiny part of your data.</p></li>
</ul>
</div>
</div>
<div class="section" id="alternative-windows-for-minimizing-spectral-leakage">
<h2>Alternative Windows for Minimizing Spectral Leakage<a class="headerlink" href="#alternative-windows-for-minimizing-spectral-leakage" title="Permalink to this headline">¶</a></h2>
<p>As we have seen, the boxcar window causes spectral leakage, thus, alternative <em>windows</em> have been developed in order to reduce this problem. Here, we will focus on one called the <strong>Hanning Window</strong>.</p>
<p>The Hanning window is one of many windows that acts to taper the end of the time series, rather than have a sharp rectangular corner, like a boxcar window. The functional form of the Hanning window is:</p>
<div class="math notranslate nohighlight">
\[
h(t) = \frac{1}{2}\left(1-\text{cos}(\frac{2\pi t}{T})\right) \quad \text{when $0 \leq t \leq T$}
\]</div>
<p>Notice the smooth edges of the Hanning window in <a class="reference internal" href="#hann"><span class="std std-ref">Figure 24</span></a>.</p>
<div class="figure align-default" id="hann">
<a class="reference internal image-reference" href="../../_images/Boxcar_Hanning_timedomain.png"><img alt="../../_images/Boxcar_Hanning_timedomain.png" src="../../_images/Boxcar_Hanning_timedomain.png" style="width: 691.2px; height: 345.6px;" /></a>
<p class="caption"><span class="caption-number">Fig. 24 </span><span class="caption-text">Schematic comparing the Boxcar window and Hanning window in the time domain.</span><a class="headerlink" href="#hann" title="Permalink to this image">¶</a></p>
</div>
<p>The response function of the Hanning window (i.e., the Fourier Transform) is as follows,</p>
<div class="math notranslate nohighlight">
\[
\mathcal{G}(\omega) = sinc(\omega T/2\pi) + \frac{1}{2}\left(sinc(\omega T/2\pi+1) + sinc(\omega T/2\pi-1)\right)
\]</div>
<p>The first term in the Hanning window response function is identical to the boxcar response function and the last two terms act to approximately cancel the negative side lobes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Response function for Hanning window</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="c1"># time variable</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="c1"># frequency</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="n">bxcr_response</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
<span class="n">hann_response</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot response functions for different values of T</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">bxcr_response</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Boxcar&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">hann_response</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Hanning&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fba4ea61760&gt;
</pre></div>
</div>
<img alt="../../_images/leak_31_1.png" src="../../_images/leak_31_1.png" />
</div>
</div>
<div class="section" id="windows-and-degress-of-freedom">
<h3>Windows and Degress of Freedom<a class="headerlink" href="#windows-and-degress-of-freedom" title="Permalink to this headline">¶</a></h3>
<p>Note that this additional smoothing isn’t considered in your degrees of freedom (D.O.F.) calculation, and thus, there is an additional factor added into the D.O.F. calculation to account for the smoothing by the window:</p>
<div class="math notranslate nohighlight">
\[
DOF = \frac{N}{M^*}f_w
\]</div>
<p>where <span class="math notranslate nohighlight">\(f_w\)</span> is a factor to compensate for the extra smoothing by the window. It is generally between 1 and 1.5 depending on how much smoothing the window does. For a Hanning window, <span class="math notranslate nohighlight">\(f_w\)</span> = 1.2.</p>
</div>
</div>
<div class="section" id="welch-s-overlapping-segment-analysis-method">
<h2>Welch’s Overlapping Segment Analysis Method<a class="headerlink" href="#welch-s-overlapping-segment-analysis-method" title="Permalink to this headline">¶</a></h2>
<p>One of the problems with the Hanning window, is that if you have a short time series, you will end up using very little of the data at the edges of your time series due to the tapered window But, this data is just as important as the data in the center of the time series! This is not only a problem for short time series, but it can also, be a problem when you split your time series into smaller chunks to construct a continuous power spectrum and increase your degrees of freedom.</p>
<p>For example, we might want to split our time series into 2 chunks (see <a class="reference internal" href="#wosa"><span class="std std-ref">Figure 25</span></a> below). To reduce tapering at the edges, often one will apply the window to one chunk of data, and include a 50% overlap with that data when calculating the second chunk of data. In this case, you will have more than 2 chunks (you will have 3 chunks). It turns out that even though it may feel like you are double counting data, you actually gain 2 degrees of freedom per chunk (including those overlapping) if you are using a Hanning window. That is, if you use a 50% overlap with a Hanning window you will have 3 x 2 x 1.2 = 7.2 degrees of freedom per spectral estimate!</p>
<div class="figure align-default" id="wosa">
<a class="reference internal image-reference" href="../../_images/WOSA.png"><img alt="../../_images/WOSA.png" src="../../_images/WOSA.png" style="width: 832.0px; height: 167.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 25 </span><span class="caption-text">Schematic of Welch’s Overlapping Segment Analysis (WOSA) Method for two chunks.</span><a class="headerlink" href="#wosa" title="Permalink to this image">¶</a></p>
</div>
<p>Let’s take a look at the python function <code class="docutils literal notranslate"><span class="pre">scipy.sig.welch</span></code> that we have used previously, now that we know a bit more about it and its connection to the issue of spectral leakage. We will use cosine wave time series with a bit of white noise to test the <code class="docutils literal notranslate"><span class="pre">sig.welch</span></code> function.</p>
<p>We are also going to divide the time series into 4 chunks, so you will see a new parameter below for the number of chunks. Use the “Live Code/Lauch Thebe” button to see how the power spectrum changes if you change the number of chunks. Try 1, 2 and 8 chunks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># input parameters</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">256</span>         <span class="c1">#length of time series</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>           <span class="c1">#number of chunks</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>     <span class="c1">#red noise lag-one autocorrelation</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1">#beta, red noise parameter</span>

<span class="n">T2</span> <span class="o">=</span> <span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">T2</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Calcalute the red noise spectrum:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># contstruct expected red noise spectrum </span>
<span class="n">rspec</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">rspec</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">alpha</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">/</span><span class="n">T2</span><span class="p">)</span><span class="o">+</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we will do the same procedure that we did in the last section, except that we will change the argument, <code class="docutils literal notranslate"><span class="pre">nperseg</span></code> in the <code class="docutils literal notranslate"><span class="pre">sig.welch</span></code> function to indicate the size of each chunk.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize array for zeros for synthetic time series</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">,)</span>

<span class="c1"># construct synthetic time series (note the f for the cosine wave is approximate 0.2)</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span>

<span class="c1"># compute power spectrum (try window = &quot;boxcar&quot; for comparison)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="s1">&#39;hanning&#39;</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">N</span><span class="p">))</span>
<span class="n">pave</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># normalize the spectrum</span>
<span class="n">pave</span> <span class="o">=</span> <span class="n">pave</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pave</span><span class="p">)</span>

<span class="c1"># calculate significance using F-test</span>
<span class="n">dof</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">*</span><span class="mf">1.2</span>
<span class="n">fstat</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="o">.</span><span class="mi">99</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">spec99</span> <span class="o">=</span> <span class="p">[</span><span class="n">fstat</span><span class="o">*</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">rspec</span><span class="p">]</span>
    
<span class="n">fstat</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="o">.</span><span class="mi">95</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">spec95</span> <span class="o">=</span> <span class="p">[</span><span class="n">fstat</span><span class="o">*</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">rspec</span><span class="p">]</span>
    
<span class="c1"># plot power spectrum and red noise spectra</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (cycles per time step)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Power&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;# Chunks = 4&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">pave</span><span class="p">,</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">rspec</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rspec</span><span class="p">),</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;red-noise fit&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">spec99</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rspec</span><span class="p">),</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;99</span><span class="si">% c</span><span class="s1">onfidence&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">spec95</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rspec</span><span class="p">),</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;95</span><span class="si">% c</span><span class="s1">onfidence&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/leak_37_0.png" src="../../_images/leak_37_0.png" />
</div>
</div>
<p>You should notice that the spectral peak gets wider as we increase the number of chunks. This is because we are losing information as the time segments get shorter; however, the WOSA method is still able to identify the correct frequency for the peak and as we increase the number of chunks, the peak corresponding to the periodic frequency in our data emerges as the only significant one - reducing spectral leakage.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "kls2177/Climate-and-Geophysical-Data-Analysis",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapters/Week6"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="filtering_in_freq3.html" title="previous page">Continuous Power Spectrum and the Significance of Spectral Peaks</a>
    <a class='right-next' id="next-link" href="convolution_filters_in_time.html" title="next page">Convolution and Filtering in the Time Domain</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Karen Smith<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>