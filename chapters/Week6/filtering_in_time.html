
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filtering in the Time Domain: Part I &#8212; Climate and Geophysical Data Analysis</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://kls2177.github.io/Climate-and-Geophysical-Data-Analysis/chapters/index.html/chapters/Week6/filtering_in_time.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Filtering in the Time Domain: Part II" href="Harmonics.html" />
    <link rel="prev" title="Time Series Analysis" href="filt.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://kls2177.github.io/Climate-and-Geophysical-Data-Analysis/chapters/index.html/chapters/Week6/filtering_in_time.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Filtering in the Time Domain: Part I" />
<meta property="og:description" content="Filtering in the Time Domain: Part I  In this section, we will explore some simple techniques to filter time series in the time domain. To familiarize ourselves" />
<meta property="og:image"       content="https://kls2177.github.io/Climate-and-Geophysical-Data-Analysis/chapters/index.html/_static/gistemp.png" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/gistemp.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Climate and Geophysical Data Analysis</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Climate and Geophysical Data Analysis
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction/intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week1a/whatarestatsgoodfor.html">
   What are statistics good for?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week1b/descriptivestats.html">
   Descriptive Statistics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week2/hypothesis_testing.html">
   Statistical Hypothesis Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week3/linreg.html">
   Linear Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week4/corr.html">
   Correlation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Week5/persistence.html">
   Persistence in Time Series
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="reference internal" href="filt.html">
   Time Series Analysis
  </a>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Filtering in the Time Domain: Part I
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Harmonics.html">
     Filtering in the Time Domain: Part II
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="filtering_in_freq1.html">
     Filtering in the Frequency Domain: Discrete Fourier Transform
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="filtering_in_freq2.html">
     Fast Fourier Transform
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="filtering_in_freq3.html">
     Continuous Power Spectrum and the Significance of Spectral Peaks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="leak.html">
     Spectral Leakage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="convolution_filters_in_time.html">
     Convolution and Filtering in the Time Domain
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/chapters/Week6/filtering_in_time.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/kls2177/Climate-and-Geophysical-Data-Analysis/master?urlpath=tree/chapters/Week6/filtering_in_time.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/kls2177/Climate-and-Geophysical-Data-Analysis/blob/master/chapters/Week6/filtering_in_time.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-1-filtering-out-the-long-term-trend">
   Example 1: Filtering out the Long-term Trend
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-2-filtering-out-the-seasonal-cycle">
   Example 2: Filtering out the Seasonal Cycle
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#method-1-filtering-out-the-climatological-seasonal-cycle">
     Method 1: Filtering out the Climatological Seasonal Cycle
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#method-2-filtering-out-the-running-mean-seasonal-cycle">
     Method 2: Filtering out the Running-Mean Seasonal Cycle
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#variations-on-running-mean-filters">
       Variations on Running-Mean Filters
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#method-3-filtering-using-local-regression">
     Method 3: Filtering using Local Regression
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="filtering-in-the-time-domain-part-i">
<h1>Filtering in the Time Domain: Part I<a class="headerlink" href="#filtering-in-the-time-domain-part-i" title="Permalink to this headline">¶</a></h1>
<p>In this section, we will explore some simple techniques to filter time series in the <em>time domain</em>. To familiarize ourselves with the concept of filtering, we will take a look at a two common examples of filtering in the fields of climate science and geophysics.</p>
<div class="section" id="example-1-filtering-out-the-long-term-trend">
<h2>Example 1: Filtering out the Long-term Trend<a class="headerlink" href="#example-1-filtering-out-the-long-term-trend" title="Permalink to this headline">¶</a></h2>
<p>As we discussed in the previous section, autocorrelation in a time series means that the data are not indepedent and that the sample size is an overestimate. Autocorrelation is often the result of a <em>long-term trend</em>. So, one way around this is to remove the long-term trend.</p>
<p>Let’s start by returning to our TLT temperature time series example in the <a class="reference external" href="https://kls2177.github.io/Climate-and-Geophysical-Data-Analysis/chapters/Week5/autocorr_example.html">previous section</a> to examine filtering of the long-term trend.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">pickle</span> <span class="k">as</span> <span class="nn">pickle</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span> <span class="c1">#set default font size and weight for plots</span>
</pre></div>
</div>
</div>
</div>
<p>Read in monthly TLT data starting in Jan. 1979 - Dec. 2019. The file is <a class="reference external" href="https://github.com/kls2177/ccia_files/blob/master/TLT_19792019.csv?raw=true">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in TLT file</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;TLT_19792019.csv&#39;</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>

<span class="c1"># Extract Dec. 1979 - November 2019 and just extract last column (temperature data)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># Alternative way to compute the seasonal averages</span>
<span class="n">T_seasons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Recall that this data set has contains a long-term trend. Let’s plot the data to remind ourselves of how it looks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create time index for plotting and for regression</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">T_seasons</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Plot the data (update to Fig. 3 of Santer et al. 2000)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># plot time series</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="n">T_seasons</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># calculate best-fit line</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="n">T_seasons</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">T_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">time</span><span class="p">)</span>

<span class="c1"># plot best-fit line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="n">T_hat</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># ticks, labels, etc.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">),</span><span class="mi">20</span><span class="p">),[</span><span class="s2">&quot;1980&quot;</span><span class="p">,</span><span class="s2">&quot;1985&quot;</span><span class="p">,</span><span class="s2">&quot;1990&quot;</span><span class="p">,</span><span class="s2">&quot;1995&quot;</span><span class="p">,</span><span class="s2">&quot;2000&quot;</span><span class="p">,</span><span class="s2">&quot;2005&quot;</span><span class="p">,</span><span class="s2">&quot;2010&quot;</span><span class="p">,</span><span class="s2">&quot;2015&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">))</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.925</span><span class="p">,</span><span class="s1">&#39;LS trend = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">40</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;$^o$C/decade&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> 
         <span class="n">transform</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span> <span class="c1">#we multiply by 40 because our unit of time is seasons but we</span>
                                                        <span class="c1">#want to report the trend in deg C per decade</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;TLT Anomaly&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Seasonal TLT Time Series (1980-2019)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Seasonal TLT Time Series (1980-2019)&#39;)
</pre></div>
</div>
<img alt="../../_images/filtering_in_time_5_1.png" src="../../_images/filtering_in_time_5_1.png" />
</div>
</div>
<p>As we saw, this trend introduces high autocorrelation at non-zero lags. How would you filter out this trend? We have done this before. Think about it before you reveal the code below.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># detrend the TLT temperature time series</span>
<span class="n">T_dtr</span> <span class="o">=</span> <span class="n">T_seasons</span> <span class="o">-</span> <span class="n">T_hat</span>
</pre></div>
</div>
</div>
</div>
<p>We also saw in the previous section that this <em>detrended</em> temperature time series has reduced autocorrelation relative to the original time series. Let’s go through this calculation again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># np.correlate actually gives the covariance. We need to find the covariance of the deviations from the mean and then</span>
<span class="c1">#  divide the the tau=0 covariance, i.e., the variance to get the correlation</span>

<span class="n">Tcorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">((</span><span class="n">T_seasons</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">T_seasons</span><span class="p">)),(</span><span class="n">T_seasons</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">T_seasons</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T_seasons</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">T_seasons</span><span class="p">)),</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>
<span class="n">Tcorr_dtr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">((</span><span class="n">T_dtr</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">T_dtr</span><span class="p">)),(</span><span class="n">T_dtr</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">T_dtr</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T_dtr</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">T_dtr</span><span class="p">)),</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The autocorrelation functions clearly show that we have successfully removed some of the high autocorrelation in our time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot the autocorrelation function</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="c1"># x-value for plotting</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">T_seasons</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="n">series</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">T_seasons</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

<span class="c1">#plot series</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">series</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T_seasons</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):],</span><span class="n">Tcorr</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T_seasons</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;TLT&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">series</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T_seasons</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):],</span><span class="n">Tcorr_dtr</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T_seasons</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Detrended TLT&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">80</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Correlation Coefficient&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Lag&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f9de1d8fb80&gt;
</pre></div>
</div>
<img alt="../../_images/filtering_in_time_11_1.png" src="../../_images/filtering_in_time_11_1.png" />
</div>
</div>
<p>In this example, we see how filtering out the long-term trend, i.e. detrending, helps to address (although not fully) the issue of autocorrelated time series.</p>
<p>Although this tends to be the primary reason that we detrend time series, there may be reasons you may want to detrend. For example, you may want to test specific scientific hypotheses that are not associated with the long-term trend, e.g. you may want to examine the year-to-year relationship between two variables.</p>
</div>
<div class="section" id="example-2-filtering-out-the-seasonal-cycle">
<h2>Example 2: Filtering out the Seasonal Cycle<a class="headerlink" href="#example-2-filtering-out-the-seasonal-cycle" title="Permalink to this headline">¶</a></h2>
<p>One feature of many climate and geophysical variables that results in autocorrelation is the <strong>seasonal cycle</strong>. In the following example, we will explore different methods to remove the seasonal cycle in order to reduce the autocorrelation. Again, reducing the autocorrelation, may not be the only reason to do this, but it is often the primary reason.</p>
<p>To look at this problem, we will load in some Arctic sea ice extent (SIE) data from a pre-industrial integration of a global climate model (GCM). I have chosen to use data from a <em>pre-industrial</em> integration in order to focus on the seasonal cycle rather than the long-term trend that is evident in historical (GCM) integrations. The file is <a class="reference external" href="https://github.com/kls2177/ccia_files/blob/master/SIE_Total.pickle?raw=true">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in Arctic SIE data</span>
<span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;SIE_Total.pickle&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">sie</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;iso8859&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The data should consist of 400 years of daily (365 days per year) of SIE data. Let’s take a look:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print shape of data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sie</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(400, 365)
</pre></div>
</div>
</div>
</div>
<p>Let’s reshape this data into one long time series, rather than a 2-D array of years and days.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert sie to time series </span>
<span class="c1">#  (I&#39;m using np.ravel() but you can also use np.reshape())</span>
<span class="n">sie_ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">sie</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s plot the time series to see what it looks like. We will only plot the first 50 years so that we can clearly see the seasonal cycle.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot Arctic SIE time series to show the seasonal cycle</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="c1"># this data consists of 400 years of daily data, but here I am just plotting 50 years</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sie_ts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="o">*</span><span class="mi">365</span><span class="p">]</span><span class="o">/</span><span class="mf">1e12</span><span class="p">)</span> <span class="c1"># divide by 10**12 for plotting</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="o">*</span><span class="mi">365</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sea Ice Extent (10$^6$ km$^2$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SIE from GCM Pre-Industrial Integration (first 50 years only)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/filtering_in_time_20_0.png" src="../../_images/filtering_in_time_20_0.png" />
</div>
</div>
<div class="section" id="method-1-filtering-out-the-climatological-seasonal-cycle">
<h3>Method 1: Filtering out the Climatological Seasonal Cycle<a class="headerlink" href="#method-1-filtering-out-the-climatological-seasonal-cycle" title="Permalink to this headline">¶</a></h3>
<p>Previously, we have defined anomalies in the following way:</p>
<div class="math notranslate nohighlight">
\[
x_i^\prime(t) = x_i(t) - \overline{x}
\]</div>
<p>for each <span class="math notranslate nohighlight">\(i\)</span> in a time series, <span class="math notranslate nohighlight">\(i\)</span> = 0, … ,<span class="math notranslate nohighlight">\(N\)</span>.</p>
<p>In other words, we have defined anomalies as the deviation from the time mean. But, the time mean is not that meaningful when we have a large seasonal cycle. Alternatively, we can define anomalies instead by subtracting the seasonal time mean for each day or month of the year:</p>
<div class="math notranslate nohighlight">
\[
x_{ij}^\prime(t) = x_{ij}(t) - \overline{x_j}
\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> is a year and <span class="math notranslate nohighlight">\(j\)</span> is the day of the year (for data with daily temporal resolution). Thus, <span class="math notranslate nohighlight">\(\overline{x_j}\)</span> represents the <em>climatology</em> or the time mean of the seasonal cycle. If we subtract this, then we should be left with all the variability that is not associated with this time mean seasonal cycle.</p>
<p>Let’s take a closer look at the meaning of <span class="math notranslate nohighlight">\(\overline{x_j}\)</span> using our Arctic SIE data. <a class="reference internal" href="#anomaly"><span class="std std-ref">Figure 19</span></a> shows a section of the Arctic SIE time series with dots added showing values in the time series for all the January 1st’s. The black horizontal line shows the average of all the January 1st’s. Thus, value of the black line is equal to <span class="math notranslate nohighlight">\(\overline{x_j}\)</span>, where <span class="math notranslate nohighlight">\(j\)</span> = January 1st.</p>
<div class="figure align-default" id="anomaly">
<a class="reference internal image-reference" href="../../_images/anomaly.png"><img alt="../../_images/anomaly.png" src="../../_images/anomaly.png" style="width: 634.0px; height: 403.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 19 </span><span class="caption-text">Time series of Arctic sea ice extent from a global climate model pre-industrial integration. The dots represent January 1st and the horizonal black line represents the mean of all the January 1st’s.</span><a class="headerlink" href="#anomaly" title="Permalink to this image">¶</a></p>
</div>
<p>The SIE data that we originally loaded is in a convenient 2-D format for calculating <span class="math notranslate nohighlight">\(\overline{x_j}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Take the average over all years to get a 365-day climatology.</span>
<span class="n">sie_clim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sie</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sie_clim</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(365,)
</pre></div>
</div>
</div>
</div>
<p>We started with an array with shape (400,365) and after we average over all years, we get an array with shape (365,).</p>
<p>The climatological seasonal cycle clearly shows the growth and decay of Arctic sea ice over the year.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the seasonal cycle</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sie_clim</span><span class="o">/</span><span class="mf">1e12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">364</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">136</span><span class="p">,</span><span class="mi">166</span><span class="p">,</span><span class="mi">197</span><span class="p">,</span><span class="mi">228</span><span class="p">,</span><span class="mi">259</span><span class="p">,</span><span class="mi">289</span><span class="p">,</span><span class="mi">320</span><span class="p">,</span><span class="mi">349</span><span class="p">],</span>
           <span class="p">[</span><span class="s2">&quot;J&quot;</span><span class="p">,</span><span class="s2">&quot;F&quot;</span><span class="p">,</span><span class="s2">&quot;M&quot;</span><span class="p">,</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;M&quot;</span><span class="p">,</span><span class="s2">&quot;J&quot;</span><span class="p">,</span><span class="s2">&quot;J&quot;</span><span class="p">,</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;S&quot;</span><span class="p">,</span><span class="s2">&quot;O&quot;</span><span class="p">,</span><span class="s2">&quot;N&quot;</span><span class="p">,</span><span class="s2">&quot;D&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Month&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sea Ice Extent (10$^6$ km$^2$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Climatological Seasonal Cycle of Arctic Sea Ice Extent&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/filtering_in_time_24_0.png" src="../../_images/filtering_in_time_24_0.png" />
</div>
</div>
<p>Now, to calculate the anomaly, i.e., to remove the climatological seasonal cycle, we simply subtract the climatology from the total, as in the equation above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove the 400-year time mean for each day from each day and convert to a long time series again.</span>
<span class="n">sie_anom</span> <span class="o">=</span> <span class="n">sie</span> <span class="o">-</span> <span class="n">sie_clim</span>
<span class="n">sie_deseason1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">sie_anom</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When we plot the anomaly, we should no longer see the large seasonal cycle in the SIE data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the SIE anomaly</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sie_deseason1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="o">*</span><span class="mi">365</span><span class="p">]</span><span class="o">/</span><span class="mf">1e12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="o">*</span><span class="mi">365</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sea Ice Extent Anomaly (10$^6$ km$^2$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SIE Anomaly from GCM Pre-Industrial Integration (first 50 years only)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/filtering_in_time_28_0.png" src="../../_images/filtering_in_time_28_0.png" />
</div>
</div>
<p>Note that the magnitude of the anomalies is quite small compared to the magnitude of the seasonal cycle. The data looks noisier and does not exhibit a seasonal cycle, but does show some decadal fluctuations. Thus, by removing the seasonal cycle using this method we have <strong>band-pass filtered</strong> the time series, leaving behind variability at both higher and lower frequencies than the seasonal cycle.</p>
<p>The above method for removing the seasonal cycle is the most common in the climate science literature, but may not always be appropriate, for example if the magnitude of the seasonal cycle consistently changes as a function of time.</p>
</div>
<div class="section" id="method-2-filtering-out-the-running-mean-seasonal-cycle">
<h3>Method 2: Filtering out the Running-Mean Seasonal Cycle<a class="headerlink" href="#method-2-filtering-out-the-running-mean-seasonal-cycle" title="Permalink to this headline">¶</a></h3>
<p><strong>Running-mean</strong> filters are filters that <em>low-pass</em> filter the data by averaging over specific time interval of interest, <span class="math notranslate nohighlight">\(L\)</span>. Here is an example of a running-mean filter for <span class="math notranslate nohighlight">\(L\)</span> = 3:</p>
<div class="math notranslate nohighlight">
\[
y(t) = \frac{1}{3}x(t - 1) + \frac{1}{3}x(t) + \frac{1}{3}x(t + 1)
\]</div>
<p>where <span class="math notranslate nohighlight">\(y(t)\)</span> is the filtered time series. Similarly, a running-mean filter of <span class="math notranslate nohighlight">\(L\)</span> = 5 can be written in the following way,</p>
<div class="math notranslate nohighlight">
\[
y(t) = \frac{1}{5}x(t - 2) + \frac{1}{5}x(t - 1) + \frac{1}{5}x(t) + \frac{1}{5}x(t + 1) + + \frac{1}{5}x(t + 2)
\]</div>
<p>If we are interested in removing the seasonal cycle using a running-mean filter, then we need to choose <span class="math notranslate nohighlight">\(L\)</span>, such that we are smoothing out the seasonal cycle.</p>
<p>So, for monthly, data, <span class="math notranslate nohighlight">\(L\)</span> = 12 and for daily data, <span class="math notranslate nohighlight">\(L\)</span> = 365.</p>
<p>Applying such a filter, we end up with a smoothed time series, with the seasonal cycle removed. Let’s try this with our Arctic SIE data. We will first write out an expression for a running-mean filter from scratch.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can remove the seasonal mean using a 365-day running mean</span>

<span class="c1"># initialize array</span>
<span class="n">sie_deseason2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sie_ts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">365</span><span class="p">]))</span>

<span class="c1"># Here is the code from scratch</span>
<span class="c1"># Loop over elements of sie_ts and compute centred 365-day average each time</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">183</span><span class="p">,</span><span class="mi">400</span><span class="o">*</span><span class="mi">365</span><span class="o">-</span><span class="mi">182</span><span class="p">):</span>
    <span class="n">sie_deseason2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sie_deseason2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sie_ts</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">182</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">183</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>The above code illustrates how a running-mean filter works, by looping over each time, <span class="math notranslate nohighlight">\(t\)</span> and computing the centred 365-day average each time. Thus, we have the final filtered time series is shorter than the original by 182 days at each end of the time series.</p>
<p>There is a python package called <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.convolve.html"><code class="docutils literal notranslate"><span class="pre">np.convolve()</span></code></a> that allows us to compute a running-mean filter in one step. The inputa to the function are the time series to be filtered and the filter. In this case the filter is an array of length <span class="math notranslate nohighlight">\(L\)</span> divided by <span class="math notranslate nohighlight">\(L\)</span>. The filter is multiplied by each overlapping 365-day segment of the time series and the function computes the sum of each segment and outputs the filtered time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here is a nice python package that does the same thing as the code above</span>
<span class="n">sie_deseason3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">sie_ts</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">365</span><span class="p">,))</span><span class="o">/</span><span class="mf">365.0</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that the length of the filtered time series is 364 days shorter than the original time series (182 days have been excluded from each end of the time series).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Printe shapes of filtered and raw time series</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sie_deseason3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sie_ts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>145636 146000
</pre></div>
</div>
</div>
</div>
<p>Let’s plot our new filtered time series and see what it looks like. We will also compare the running-mean method of removing the seasonal cycle to Method 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot raw and running-mean filtered time series</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sie_ts</span><span class="p">[</span><span class="mi">182</span><span class="p">:</span><span class="mi">50</span><span class="o">*</span><span class="mi">365</span><span class="o">+</span><span class="mi">182</span><span class="p">]</span><span class="o">/</span><span class="mf">1e12</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Raw Time Series&quot;</span><span class="p">)</span> <span class="c1"># note that the start index is 182 to match the running-mean filter</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sie_deseason3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="o">*</span><span class="mi">365</span><span class="p">])</span><span class="o">/</span><span class="mf">1e12</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Low-Pass Filtered Time Series&quot;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sea Ice Extent (10$^6$ km$^2$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;(a) SIE and Low-Pass Filtered from GCM Pre-Industrial Integration (first 50 years only)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Plot just the running-mean filtered time series</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sie_deseason3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="o">*</span><span class="mi">365</span><span class="p">])</span><span class="o">/</span><span class="mf">1e12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sea Ice Extent (10$^6$ km$^2$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;(b) Low-Pass Filtered SIE from GCM Pre-Industrial Integration (first 50 years only)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Plot anomaly time series using Method 1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sie_deseason1</span><span class="p">[</span><span class="mi">182</span><span class="p">:</span><span class="mi">50</span><span class="o">*</span><span class="mi">365</span><span class="o">+</span><span class="mi">182</span><span class="p">]</span><span class="o">/</span><span class="mf">1e12</span><span class="p">)</span> <span class="c1"># note that the start index is 182 to match the running-mean filter</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sea Ice Extent (10$^6$ km$^2$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;(c) SIE Anomaly from GCM Pre-Industrial Integration (first 50 years only)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/filtering_in_time_36_0.png" src="../../_images/filtering_in_time_36_0.png" />
</div>
</div>
<p>We can clearly see that the seasonal cycle has been smoothed out of the SIE time series in panels (a) and (b). In fact variability at frequencies equal to and also higher than <span class="math notranslate nohighlight">\(L\)</span> = 365 days has been smoothed out. The running-mean filtered time series displays variability primarily at lower frequencies.</p>
<p>Later, when we shift our analysis into the <em>spectral</em> domain, we will learn more about exactly what frequecies are filtered out using a running-mean filter and the down-sides of using these types of filters.</p>
<p>Because running-mean filters can only be used to smooth a time series, they are always a <em>low-pass</em> filters.</p>
<p>To find the <em>high-pass</em> filtered component, you can just subtract the low-pass from the original:</p>
<div class="math notranslate nohighlight">
\[
y(t)_{high-pass}  = y(t) - y(t)_{low-pass}
\]</div>
<p>A <em>band-pass</em> filter can be made by subtracting one low-pass filtered time series from another with a cutoff at a higher frequency.</p>
<div class="math notranslate nohighlight">
\[
y(t)_{band-pass}  = y(t)_{L\geq T_1} - y(t)_{L\geq T_2}
\]</div>
<p>where <span class="math notranslate nohighlight">\(T_1\)</span> <span class="math notranslate nohighlight">\(\leq\)</span> <span class="math notranslate nohighlight">\(T_2\)</span>.</p>
<div class="section" id="variations-on-running-mean-filters">
<h4>Variations on Running-Mean Filters<a class="headerlink" href="#variations-on-running-mean-filters" title="Permalink to this headline">¶</a></h4>
<p>Note that running-mean filters assume that each point in <span class="math notranslate nohighlight">\(L\)</span> is weighted equally; however, running-mean filters can be improved on by altering this assumption. For example, a <em>Gaussian</em> filter assumes that the points in <span class="math notranslate nohighlight">\(L\)</span> are weighted following a <em>Guassian</em> distribution.</p>
</div>
</div>
<div class="section" id="method-3-filtering-using-local-regression">
<h3>Method 3: Filtering using Local Regression<a class="headerlink" href="#method-3-filtering-using-local-regression" title="Permalink to this headline">¶</a></h3>
<p>The idea of <strong>Local Regression</strong> (e.g., methods such as <a class="reference external" href="https://en.wikipedia.org/wiki/Local_regression#Advantages">LOESS or LOWESS</a>) is that for a point <span class="math notranslate nohighlight">\(x\)</span> in a time series, the regression can be <em>locally</em> approximated by the value of a function in some specified parametric class (polynomial). The local approximation is obtained by fitting a regression function to the data points within a chosen “neighbourhood” of the point <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>The biggest advantage of local regression techniques over other methods is that it does not require the specification of a universal function to fit to all of the data in the sample. The biggest disadvantage is that it requires fairly large, densely sampled data sets in order to produce good models and is computationally intensive.</p>
<p>Smoothing out of low-fequency ENSO variability in the NASA GISTEMP time series is accomplished using the LOWESS technique (see <a class="reference internal" href="filt.html#gistemp"><span class="std std-ref">Figure 16</span></a>).</p>
<p>Let’s try using a local regression technique to remove the seasonal cycle in our Arctic SIE data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import LOWESS function</span>
<span class="kn">import</span> <span class="nn">statsmodels.nonparametric.smoothers_lowess</span> <span class="k">as</span> <span class="nn">lowess</span>
</pre></div>
</div>
</div>
</div>
<p>The inputs to this <a class="reference external" href="https://www.statsmodels.org/stable/generated/statsmodels.nonparametric.smoothers_lowess.lowess.html">lowess function</a> are the raw time series (the predictand), the time variable (the predictor) and the fraction of data to include in the regression (the “neighbourhood” parameter). The neighbourhood parameter allows the LOWESS model to be tuned to achieve the desired amount of smoothing.</p>
<p>You can click on the “Live Code/Launch Thebe” button and change the neighbourhood parameter to see how this affects the smoothing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># smooth first 50-years of Arctic SIE time series using LOWESS technique</span>
<span class="n">neighbourhood_param</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">sie_lfit</span> <span class="o">=</span> <span class="n">lowess</span><span class="o">.</span><span class="n">lowess</span><span class="p">(</span><span class="n">sie_ts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="o">*</span><span class="mi">365</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">sie_ts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="o">*</span><span class="mi">365</span><span class="p">])),</span><span class="n">neighbourhood_param</span><span class="p">,</span><span class="n">return_sorted</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the output and see what we get:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sie_ts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="o">*</span><span class="mi">365</span><span class="p">]</span><span class="o">/</span><span class="mf">1e12</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Raw Time Series&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sie_lfit</span><span class="o">/</span><span class="mf">1e12</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LOWESS Smoothed Time series&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sea Ice Extent (10$^6$ km$^2$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;(a) SIE and LOWESS-smoothed SIE from GCM Pre-Industrial Integration (first 50 years only)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sie_lfit</span><span class="o">/</span><span class="mf">1e12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sea Ice Extent (10$^6$ km$^2$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;(b) LOWESS-smoothed SIE from GCM Pre-Industrial Integration (first 50 years only)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/filtering_in_time_42_0.png" src="../../_images/filtering_in_time_42_0.png" />
</div>
</div>
<p>In order to remove the seasonal cyle using LOWESS smoothing, we generated a <em>very</em> smooth time series. The choice of method often depends on the variability that you would like to retain in your filtered time series.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "kls2177/Climate-and-Geophysical-Data-Analysis",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./chapters/Week6"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="filt.html" title="previous page">Time Series Analysis</a>
    <a class='right-next' id="next-link" href="Harmonics.html" title="next page">Filtering in the Time Domain: Part II</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Karen Smith<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>