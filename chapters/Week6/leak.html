

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Spectral Leakage &#8212; Climate and Geophysical Data Analysis</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/Week6/leak';</script>
    <link rel="canonical" href="https://kls2177.github.io/Climate-and-Geophysical-Data-Analysis/chapters/index.html/chapters/Week6/leak.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Convolution and Filtering in the Time Domain" href="convolution_filters_in_time.html" />
    <link rel="prev" title="Continuous Power Spectrum and the Significance of Spectral Peaks" href="filtering_in_freq3.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/landing_page.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/landing_page.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../introduction/intro.html">Introduction</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/aboutthisbook.html">About this book</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/howtousethisbook.html">How to use this book</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week1a/whatarestatsgoodfor.html">What are statistics good for?</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Week1a/goodpractice.html">Statistics is the grammar of science…</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week1a/pitfalls.html">Lies, damned lies and statistics…</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week1b/descriptivestats.html">Descriptive Statistics</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Week1b/summarystats.html">Summary Statistics: Part I</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week1b/Variance_Example.html">Example: Sensitivity of Standard Deviation to Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week1b/what_is_pdf.html">What is a distribution?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week1b/summarystats2.html">Summary Statistics: Part II</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week2/hypothesis_testing.html">Statistical Hypothesis Testing</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Week2/probability.html">Basic Probability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week2/normdist.html">The Standard Normal Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week2/zstat.html">The <em>z</em>-Statistic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week2/signal2noise.html">Signal-to-Noise</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week2/central_limit_theorem.html">The Central Limit Theorem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week2/statistical_significance.html">Estimating Statistical Significance with a <em>z</em>-test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week2/tstat.html">The <em>t</em>-Statistic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week2/resampling.html">Resampling Techniques</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week3/linreg.html">Linear Regression</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Week3/basics_linreg.html">Introduction to Linear Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week3/confidence_intervals.html">Confidence Intervals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week3/goodness.html">Goodness of Fit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week3/assumptions.html">Assumptions of Linear Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week3/composites.html">Compositing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week3/filtering.html">Filtering or Detrending using Regression</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week4/corr.html">Correlation</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Week4/corr_rev.html">Review of Correlation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week4/stat_corr.html">Statistical Significance of Correlation Coefficients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week4/nonpar_corr.html">Non-parametric Correlations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week4/autocorr.html">Autocorrelation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week5/persistence.html">Persistence in Time Series</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Week5/autocorr_example.html">Autocorrelation in Climate and Geophysical Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week5/red_noise.html">Introduction to Red Noise</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week5/autocorr_implications.html">Example: Correlation with Memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week5/n_eff.html">Accounting for Autocorrelation: Effective Sample Size</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="filt.html">Time Series Analysis</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="filtering_in_time.html">Filtering in the Time Domain: Part I</a></li>
<li class="toctree-l2"><a class="reference internal" href="Harmonics.html">Filtering in the Time Domain: Part II</a></li>
<li class="toctree-l2"><a class="reference internal" href="filtering_in_freq1.html">Filtering in the Frequency Domain: Discrete Fourier Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="filtering_in_freq2.html">Fast Fourier Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="filtering_in_freq3.html">Continuous Power Spectrum and the Significance of Spectral Peaks</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Spectral Leakage</a></li>
<li class="toctree-l2"><a class="reference internal" href="convolution_filters_in_time.html">Convolution and Filtering in the Time Domain</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Week7/pca.html">Patterns in Multivariate Data</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Week7/Intro_to_PCA.html">Introduction to Principal Component Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week7/linalg.html">Review of Linear Algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week7/eig.html">Eigenanalysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week7/eofs.html">EOFs via Eigenanalysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Week7/naoeof.html">EOFs with Real Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Week8/epilogue.html">Epilogue</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/kls2177/Climate-and-Geophysical-Data-Analysis/master?urlpath=tree/chapters/Week6/leak.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/Week6/leak.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Spectral Leakage</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-problem">Setting up the problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convolution">Convolution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#response-functions">Response Functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#characteristics-of-the-boxcar-window-response-function">Characteristics of the Boxcar Window Response Function:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-windows-for-minimizing-spectral-leakage">Alternative Windows for Minimizing Spectral Leakage</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#windows-and-degress-of-freedom">Windows and Degress of Freedom</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#welch-s-overlapping-segment-analysis-method">Welch’s Overlapping Segment Analysis Method</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="spectral-leakage">
<h1>Spectral Leakage<a class="headerlink" href="#spectral-leakage" title="Permalink to this headline">#</a></h1>
<p>Two key problems arise when conducting spectral analysis of finite, discrete time series (not an infinite time series):</p>
<ol class="arabic simple">
<li><p><strong>Aliasing:</strong> we only resolve frequencies lower than the Nyquist frequency (<span class="math notranslate nohighlight">\(\frac{1}{2\Delta t}\)</span>), and frequencies higher than this get aliased to lower frequencies.</p></li>
<li><p><strong>Spectral Leakage:</strong> we assume that all waveforms stop and start at <span class="math notranslate nohighlight">\(t\)</span> = 0 and <span class="math notranslate nohighlight">\(t\)</span> = <span class="math notranslate nohighlight">\(T\)</span>, but in the real world, many of these wave numbers may not complete a full integer number of cycles throughout the domain, causing spectral leakage to other wave numbers.</p></li>
</ol>
<p>In this section, we will address the second problem, <strong>spectral leakage</strong> and how to reduce it.</p>
<section id="setting-up-the-problem">
<h2>Setting up the problem<a class="headerlink" href="#setting-up-the-problem" title="Permalink to this headline">#</a></h2>
<p>Suppose we have a time series, <span class="math notranslate nohighlight">\(y(t)\)</span>, that is defined on -<span class="math notranslate nohighlight">\(\infty \leq t \leq \infty\)</span>.</p>
<p>Another way to conceptualize this time series would be to write it as, <span class="math notranslate nohighlight">\(y(t)g(t)\)</span>, where <span class="math notranslate nohighlight">\(g(t)\)</span> is a function with a value of 1 for all <span class="math notranslate nohighlight">\(t\)</span>, -<span class="math notranslate nohighlight">\(\infty \leq t \leq \infty\)</span>, as illustrated in the left panel in <a class="reference internal" href="#window"><span class="std std-ref">Figure 23</span></a>.</p>
<figure class="align-default" id="window">
<a class="reference internal image-reference" href="../../_images/window.png"><img alt="../../_images/window.png" src="../../_images/window.png" style="width: 841.0px; height: 330.0px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 23 </span><span class="caption-text">Schematic comparing the window function of an infinite time series, with that of a finite time series</span><a class="headerlink" href="#window" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>But what we really have is a time series, <span class="math notranslate nohighlight">\(y(t)\)</span>, that is defined a time interval from 0 <span class="math notranslate nohighlight">\(\leq t \leq T\)</span>. Applying the same conceptualization as above, we can denote this time series, <span class="math notranslate nohighlight">\(y(t)g(t)\)</span>, where now, <span class="math notranslate nohighlight">\(g(t)\)</span> now has a value of 1 over the range 0 <span class="math notranslate nohighlight">\(\leq t \leq T\)</span> and a value of zero for all other times, as illustrated in the right panel in <a class="reference internal" href="#window"><span class="std std-ref">Figure 23</span></a>.</p>
<p><span class="math notranslate nohighlight">\(g(t)\)</span> in the case of a finite time series can be thought of as a <em>window</em> and this window can act to cut-off incomplete cycles and cause spectral leakage. But what is spectral leakage, really? Let’s take a look at an example using a simple sine wave.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">sig</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s define a sine function on a time domain, such that the sine function completes <span class="math notranslate nohighlight">\(N\)</span>, integer cycles, i.e., no cycles are cut-off within the domain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define parameters</span>

<span class="c1"># length of time domain</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="c1"># time variable</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="c1"># frequency</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we can define and plot our sine function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define sine function</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot sine function</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Sine Wave&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Sine Wave&#39;)
</pre></div>
</div>
<img alt="../../_images/37079a06ce638f8825622b9b7fcff7f723a8f22e0229c80fef40509df8d3262b.png" src="../../_images/37079a06ce638f8825622b9b7fcff7f723a8f22e0229c80fef40509df8d3262b.png" />
</div>
</div>
<p>Here, we have 4 complete cycles of our sine wave. Now, let’s compute the discrete power spectrum of this sine wave.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute FFT</span>
<span class="n">yfft1_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="n">yfft1</span> <span class="o">=</span> <span class="n">yfft1_raw</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>

<span class="c1"># compute variance as a function of frequency (spectral power)</span>
<span class="n">ck2y1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yfft1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>What do you think it will look like?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot normalized power as a function of frequency</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">ck2y1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.0025</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (cycles per time step)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Power&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Discrete Power Spectrum for Un-windowed Sine Wave&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Discrete Power Spectrum for Un-windowed Sine Wave&#39;)
</pre></div>
</div>
<img alt="../../_images/b274566a395941823456a15745feda8b628df1213a3d16579f5b8d41f5325855.png" src="../../_images/b274566a395941823456a15745feda8b628df1213a3d16579f5b8d41f5325855.png" />
</div>
</div>
<p>We get a single spectral peak corresponding to the frequency of our sine wave.</p>
<p>Now, let’s see what happens if we apply a <em>window</em> to our sine wave that cuts off the sine wave such that the sine function does not complete an integer number of cycles within the time domain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now let&#39;s window our data, such that we are not cleanly sampling our sine function</span>
<span class="n">y2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bxcr</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mf">6.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">):</span>
        <span class="n">y2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">bxcr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">bxcr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
<span class="n">bxcr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">bxcr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Above, we created a window function called <code class="docutils literal notranslate"><span class="pre">bxcr</span></code> (short for box-car) and our cut-off sine wave. Let’s plot these to see what they look like. Notice that if we multiply <code class="docutils literal notranslate"><span class="pre">bxcr</span></code> and our original sine wave together we get the modified sine wave.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot windowed sine wave, window</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">bxcr</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Windowed Sine Wave&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y1</span><span class="o">*</span><span class="n">bxcr</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Also a Windowed Sine Wave&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Also a Windowed Sine Wave&#39;)
</pre></div>
</div>
<img alt="../../_images/a03d3d331c66bfc07925c7b6ebadb9134e1f89fee53157923e0c839fb0348386.png" src="../../_images/a03d3d331c66bfc07925c7b6ebadb9134e1f89fee53157923e0c839fb0348386.png" />
</div>
</div>
<p>To demonstrate what spectral leakage is, we will now compute the discrete power spectrum of the windowed sine wave to see what happens.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute FFT</span>
<span class="n">yfft2_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
<span class="n">yfft2</span> <span class="o">=</span> <span class="n">yfft2_raw</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>

<span class="c1"># compute variance as a function of frequency (spectral power)</span>
<span class="n">ck2y2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yfft2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Power Spectrum of windowed data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">ck2y2</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.0025</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;power&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Discrete Power Spectrum for Windowed Sine Wave&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Discrete Power Spectrum for Windowed Sine Wave&#39;)
</pre></div>
</div>
<img alt="../../_images/6ec1ac3511eff05cd3675b992fa02413299ce105155abd05c1e58bc5b4461893.png" src="../../_images/6ec1ac3511eff05cd3675b992fa02413299ce105155abd05c1e58bc5b4461893.png" />
</div>
</div>
<p>What happened? Our Fourier Transform is not able to clearly isolate the sine wave frequency as the only frequency. This is the essense of spectral leakage and it is problematic because it can introduce frequencies in time series that are not actually there. In order to better understand how windowing can result in spectral leakage, we need learn a bit about <strong>convolution</strong>.</p>
</section>
<section id="convolution">
<h2>Convolution<a class="headerlink" href="#convolution" title="Permalink to this headline">#</a></h2>
<p>We can minimize spectral leakage by applying different <em>windows</em> to our data, i.e., by creating different functional forms for <span class="math notranslate nohighlight">\(g(t)\)</span>. To understand how applying different windows can help, we first need to define something called <strong>convolution</strong>.</p>
<p>The convolution of two functions <span class="math notranslate nohighlight">\(y(t)\)</span> and <span class="math notranslate nohighlight">\(g(t)\)</span> is:</p>
<div class="math notranslate nohighlight">
\[
(g * y)(t) = \int_{-\infty}^{\infty} g(\tau)y(t-\tau) \,d\tau
\]</div>
<p>where the (<span class="math notranslate nohighlight">\(*\)</span>) symbol denotes a convolution. Let’s do an example to see what this equation is actually telling us (turns out it isn’t that complicated!).</p>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>Let <span class="math notranslate nohighlight">\(g(\tau)\)</span> = <span class="math notranslate nohighlight">\([\)</span>0 <span class="math notranslate nohighlight">\(\frac{1}{3}\)</span> <span class="math notranslate nohighlight">\(\frac{1}{3}\)</span> <span class="math notranslate nohighlight">\(\frac{1}{3}\)</span> 0<span class="math notranslate nohighlight">\(]\)</span> for <span class="math notranslate nohighlight">\(\tau\)</span> = -2, -1, 0, 1, 2</p>
<p>Let <span class="math notranslate nohighlight">\(y(t)\)</span> = <span class="math notranslate nohighlight">\([\)</span>9 7 8 6 5 4 3 8 9 10 11<span class="math notranslate nohighlight">\(]\)</span> for <span class="math notranslate nohighlight">\(t\)</span> = 1, 2, 3, 4,…</p>
<p>(<span class="math notranslate nohighlight">\(g * y\)</span>)(t = 4) = 7 · 0 + 8 · <span class="math notranslate nohighlight">\(\frac{1}{3}\)</span> + 6 · <span class="math notranslate nohighlight">\(\frac{1}{3}\)</span> + 5 · <span class="math notranslate nohighlight">\(\frac{1}{3}\)</span> + 4 · 0 = <span class="math notranslate nohighlight">\(\frac{19}{3}\)</span></p>
</div>
<p>Thus, the convolution is really just a <em>sliding window</em>, or, a <em>sliding weighted average</em>! <span class="math notranslate nohighlight">\(g(\tau)\)</span> could be any function, for example, the window in the right panel of <a class="reference internal" href="#window"><span class="std std-ref">Figure 23</span></a> above.</p>
<p>We have seen something similar to convolution in Assignment 2, <a class="reference external" href="https://www.youtube.com/watch?v=Ma0YONjMZLI"><strong>cross-correlation</strong></a>.</p>
<p>This brings us to the <strong>Convolution Theorem</strong></p>
<div class="note admonition">
<p class="admonition-title">Convolution Theorem</p>
<p>The convolution theorem tells us that the Fourier Transform of the product of two functions is the convolution of their individual Fourier Transforms (and vice versa).</p>
</div>
<p>Mathematically, we write,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\mathcal{F}(y(t)g(t)) &amp;= \mathcal{F}(y(t))*\mathcal{F}(g(t))\\
&amp; = \mathcal{Y}(\omega) * \mathcal{G}(\omega)
\end{align}
\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\mathcal{F}(y(t)*g(t)) &amp;= \mathcal{F}(y(t))\mathcal{F}(g(t))\\
&amp; = \mathcal{Y}(\omega)\mathcal{G}(\omega)
\end{align}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{F}\)</span> is the Fourier Transform operator and fancy capital letters denote the Fourier Transform of their lower-case functions. And recall that,</p>
<div class="math notranslate nohighlight">
\[
y(t) = \frac{1}{2\pi}\int_{-\infty}^{\infty} Y(\omega)e^{i\omega t} \,d\omega
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
Y(\omega) = \int_{-\infty}^{\infty} y(t)e^{-i\omega t} \,dt
\]</div>
<p>Now, what does all this mean for spectral leakage? So, back to <a class="reference internal" href="#window"><span class="std std-ref">Figure 23</span></a>: if we have a finite time series, <span class="math notranslate nohighlight">\(y(t)\)</span>, when we take its Fourier Transform, what we are really doing is taking the Fourier Transform of <span class="math notranslate nohighlight">\(y(t)g(t)\)</span>! Cool! So, the Convolution Theorem then tells us that the Fourier Transform of <span class="math notranslate nohighlight">\(y(t)g(t)\)</span> is the convolution of the individual Fourier Transforms resulting in <strong>spectral leakage</strong>.</p>
<p>Mathematically, the Convolution Theorem tells us that if,</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
\mathcal{F}(y(t)g(t)) &amp;= \int_{-\infty}^{\infty} y(t)g(t)e^{-i\omega t} \,dt
\end{align}
\]</div>
<p>then,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\mathcal{F}(y(t)g(t)) &amp;= \mathcal{F}(y(t))*\mathcal{F}(g(t))\\
&amp; = \mathcal{Y}(\omega) * \mathcal{G}(\omega)\\
&amp; = \int_{-\infty}^{\infty} \mathcal{Y}(\omega_0)\mathcal{G}(\omega-\omega_0) \,d\omega_0
\end{align}
\end{split}\]</div>
<p>So, the Fourier Transform of our discrete and finite time series <span class="math notranslate nohighlight">\(y(t)\)</span> with window <span class="math notranslate nohighlight">\(g(t)\)</span> can be found by convolving the individual Fourier Transforms <span class="math notranslate nohighlight">\(\mathcal{Y}(\omega)\)</span> and <span class="math notranslate nohighlight">\(\mathcal{G}(\omega)\)</span>!</p>
<p>One way to think about this is that our infinite Fourier Transform <span class="math notranslate nohighlight">\(\mathcal{Y}(\omega)\)</span> gets smoothed out by a moving weighted average that looks like the Fourier Transform of <span class="math notranslate nohighlight">\(g(t)\)</span> (namely, <span class="math notranslate nohighlight">\(\mathcal{G}(\omega)\)</span>).</p>
<p>Let’s revisit the sine wave example above to see what this works. First, let’s compute the FFT of the window, <code class="docutils literal notranslate"><span class="pre">bxcr</span></code> and plot the power spectrum.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute FFT</span>
<span class="n">bfft_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">bxcr</span><span class="p">)</span>
<span class="n">bfft</span> <span class="o">=</span> <span class="n">bfft_raw</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bxcr</span><span class="p">)</span>

<span class="c1"># compute variance as a function of frequency (spectral power)</span>
<span class="n">ck2bxcr</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bfft</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Power spectrum of boxcar window</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">ck2bxcr</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.0025</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;power&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Discrete Power Spectrum for Boxcar Function&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Discrete Power Spectrum for Boxcar Function&#39;)
</pre></div>
</div>
<img alt="../../_images/72e0e97fc0327318e11a46c3be2ba41d9b5c59bc1dbd38c23ca09b2fabb09c96.png" src="../../_images/72e0e97fc0327318e11a46c3be2ba41d9b5c59bc1dbd38c23ca09b2fabb09c96.png" />
</div>
</div>
<p>We can test the convolution theorem, by convolving the two individual Fourier Transforms of <code class="docutils literal notranslate"><span class="pre">y1</span></code> and <code class="docutils literal notranslate"><span class="pre">bxcr</span></code> and see if we get the Fourier Transform of their product, <code class="docutils literal notranslate"><span class="pre">y2</span></code>. Note, that the <a class="reference external" href="http://greenteapress.com/thinkdsp/html/thinkdsp009.html">most efficient way to do this convolution in python and to avoid issues with zero-padding using the <code class="docutils literal notranslate"><span class="pre">np.convolve</span></code> function, etc.</a> is to apply the <a class="reference external" href="https://en.wikipedia.org/wiki/Convolution_theorem#Convolution_theorem_for_inverse_Fourier_transform">convolution Theorem for the Inverse Fourier Transform</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convolution of y1 and bxcr using inverse FFT</span>
<span class="n">cfft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">yfft1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">bfft</span><span class="p">))</span>

<span class="c1"># compute variance as a function of frequency (spectral power)</span>
<span class="n">ck2c</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cfft</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot thie discrete power spectrum. We should get something that looks like the discrete power spectrum for <code class="docutils literal notranslate"><span class="pre">y2</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">ck2c</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.0025</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;power&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Discrete Power Spectrum for Boxcar Function&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Discrete Power Spectrum for Boxcar Function&#39;)
</pre></div>
</div>
<img alt="../../_images/167c755a9044a919436a7477123647252b350e618a760f8650d4ea2a1a32bbe7.png" src="../../_images/167c755a9044a919436a7477123647252b350e618a760f8650d4ea2a1a32bbe7.png" />
</div>
</div>
<p>We see that we can recover the windowed discrete power spectrum of <code class="docutils literal notranslate"><span class="pre">y2</span></code> when we convolve the Fourier Transforms of the individual time series, <code class="docutils literal notranslate"><span class="pre">y1</span></code> and <code class="docutils literal notranslate"><span class="pre">bxcr</span></code>.</p>
</section>
<section id="response-functions">
<h2>Response Functions<a class="headerlink" href="#response-functions" title="Permalink to this headline">#</a></h2>
<p>The function <span class="math notranslate nohighlight">\(\mathcal{G}(\omega-\omega_0)\)</span> is called the response function of window <span class="math notranslate nohighlight">\(g(t)\)</span> that acts on the original time series (where <span class="math notranslate nohighlight">\(g(t)\)</span> is a window in time, not in frequency).</p>
<p><em>Ideal Case (no window):</em></p>
<p>In an ideal world, we would like our window <span class="math notranslate nohighlight">\(g(t)\)</span> to give us a response function of <span class="math notranslate nohighlight">\(\mathcal{G}(\omega-\omega_0)\)</span> such that,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\mathcal{G}(\omega-\omega_0) &amp;= 1 \quad \text{when $\omega = \omega_0$}\\
\mathcal{G}(\omega-\omega_0) &amp;= 0 \quad \text{when $\omega \neq \omega_0$}\\
\end{align}
\end{split}\]</div>
<p>That is, a delta function at lag 0 (or, where <span class="math notranslate nohighlight">\(\omega=\omega_0\)</span>).</p>
<p><em>Boxcar Window</em>:</p>
<p>In reality, the response function for our discrete window is very different from this, for example, consider the naive window that we all automatically use when analyzing discrete data, i.e. the Boxcar Window:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
g(t) &amp;= 1 \quad \text{when $0 \leq t \leq T$}\\
g(t) &amp; = 0 \quad \text{for all other $t$}
\end{align}
\end{split}\]</div>
<p>The Fourier Transform of the Boxcar Function is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\mathcal{G}(\omega) &amp;= \frac{\text{sin}(\omega T/2)}{\omega T/2}\\
 &amp;= sinc(\omega T/2\pi)
\end{align}
\end{split}\]</div>
<p>where the normalized <span class="math notranslate nohighlight">\(sinc\)</span> function is defined as,</p>
<div class="math notranslate nohighlight">
\[
sinc(x) = \frac{\text{sin}(\pi x)}{\pi x}
\]</div>
<p>Let’s plot the <span class="math notranslate nohighlight">\(sinc\)</span> function and see what it looks like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Response function for boxcar window for different values of T</span>
<span class="n">bxcr_response</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">freq</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">102</span><span class="p">):</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="c1"># time variable</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="c1"># frequency</span>
    <span class="n">freq_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    
    <span class="n">bxcr_response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">freq_tmp</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
    <span class="n">freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq_tmp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot this response function as a function of frequency. Note that this is not a plot of power. This plot corresponds to the Fourier Transform of the boxcar window.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot response functions for different values of T</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">bxcr_response</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;T = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;$\pi$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">freq</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x176886200&gt;
</pre></div>
</div>
<img alt="../../_images/9ef6ff0576db61c375ac32fe366c231f958ddf117a047cd15a8292cfec44a6d5.png" src="../../_images/9ef6ff0576db61c375ac32fe366c231f958ddf117a047cd15a8292cfec44a6d5.png" />
</div>
</div>
<p>Recall why we are looking at this: The Fourier Transform of a windowed time series corresponds to the convolution of the individual Fourier Transforms (convolution theorem!). Thus, the above plot shows the function that is being <em>convolved</em> with the pure periodic signal in our time series leading to spectral leakage. Remember that a convolution can be thought of as a sliding weighted average.</p>
<p>So, what do you see? The ideal response function, as described above, should just be a step function, i.e. it should have a value of 1 at lag = 0 (in this plot, <span class="math notranslate nohighlight">\(\omega\)</span> = 0) and a value of 0 everywhere else. This is not what we see for the boxcar window. We do see a value of 1 at lag = 0, but we see many other non-zero values at higher lags. Notice the large negative side lobe and their rather slow, oscillatory decay. We also see that as <span class="math notranslate nohighlight">\(T\)</span> gets larger, the boxcar function approaches a step function, but never truly gets there.</p>
<section id="characteristics-of-the-boxcar-window-response-function">
<h3>Characteristics of the Boxcar Window Response Function:<a class="headerlink" href="#characteristics-of-the-boxcar-window-response-function" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><strong>smoothing:</strong> when the spectrum is calculated through a boxcar, the window acts to smooth and distort the true spectrum.</p></li>
<li><p><strong>side lobes:</strong> note the side lobes, these can be a real problem as they add frequencies to your spectrum that may not have been present in your original data - the reason for the side lobe is that these are the higher frequency harmonics needed to try and fit the sharp corners of the boxcar window.</p></li>
<li><p><strong>small T:</strong> note that for small T, the frequency window (response function) is much wider, and thus, there is more smoothing among the different frequencies.</p></li>
<li><p><strong>large T:</strong> for large T, the frequency window (response function) is more like a delta function, and becomes closer and closer to the ideal response function. For large T, this makes sense, because the edges of your “boxcar” are just a tiny part of your data.</p></li>
</ul>
</section>
</section>
<section id="alternative-windows-for-minimizing-spectral-leakage">
<h2>Alternative Windows for Minimizing Spectral Leakage<a class="headerlink" href="#alternative-windows-for-minimizing-spectral-leakage" title="Permalink to this headline">#</a></h2>
<p>As we have seen, the boxcar window causes spectral leakage, thus, alternative <em>windows</em> have been developed in order to reduce this problem. Here, we will focus on one called the <strong>Hanning Window</strong>.</p>
<p>The Hanning window is one of many windows that acts to taper the end of the time series, rather than have a sharp rectangular corner, like a boxcar window. The functional form of the Hanning window is:</p>
<div class="math notranslate nohighlight">
\[
h(t) = \frac{1}{2}\left(1-\text{cos}(\frac{2\pi t}{T})\right) \quad \text{when $0 \leq t \leq T$}
\]</div>
<p>Notice the smooth edges of the Hanning window in <a class="reference internal" href="#hann"><span class="std std-ref">Figure 24</span></a>.</p>
<figure class="align-default" id="hann">
<a class="reference internal image-reference" href="../../_images/Boxcar_Hanning_timedomain.png"><img alt="../../_images/Boxcar_Hanning_timedomain.png" src="../../_images/Boxcar_Hanning_timedomain.png" style="width: 691.2px; height: 345.6px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 24 </span><span class="caption-text">Schematic comparing the Boxcar window and Hanning window in the time domain.</span><a class="headerlink" href="#hann" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The response function of the Hanning window (i.e., the Fourier Transform) is as follows,</p>
<div class="math notranslate nohighlight">
\[
\mathcal{G}(\omega) = sinc(\omega T/2\pi) + \frac{1}{2}\left(sinc(\omega T/2\pi+1) + sinc(\omega T/2\pi-1)\right)
\]</div>
<p>The first term in the Hanning window response function is identical to the boxcar response function and the last two terms act to approximately cancel the negative side lobes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Response function for Hanning window</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="c1"># time variable</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="c1"># frequency</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="n">bxcr_response</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
<span class="n">hann_response</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot response functions for different values of T</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">bxcr_response</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Boxcar&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">hann_response</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Hanning&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x176976380&gt;
</pre></div>
</div>
<img alt="../../_images/bc3045eb1c6a3360e04f8aa1dcefc84c253571c404688bc0154b38bf418ff26d.png" src="../../_images/bc3045eb1c6a3360e04f8aa1dcefc84c253571c404688bc0154b38bf418ff26d.png" />
</div>
</div>
<section id="windows-and-degress-of-freedom">
<h3>Windows and Degress of Freedom<a class="headerlink" href="#windows-and-degress-of-freedom" title="Permalink to this headline">#</a></h3>
<p>Note that this additional smoothing isn’t considered in your degrees of freedom (D.O.F.) calculation, and thus, there is an additional factor added into the D.O.F. calculation to account for the smoothing by the window:</p>
<div class="math notranslate nohighlight">
\[
DOF = \frac{N}{M^*}f_w
\]</div>
<p>where <span class="math notranslate nohighlight">\(f_w\)</span> is a factor to compensate for the extra smoothing by the window. It is generally between 1 and 1.5 depending on how much smoothing the window does. For a Hanning window, <span class="math notranslate nohighlight">\(f_w\)</span> = 1.2.</p>
</section>
</section>
<section id="welch-s-overlapping-segment-analysis-method">
<h2>Welch’s Overlapping Segment Analysis Method<a class="headerlink" href="#welch-s-overlapping-segment-analysis-method" title="Permalink to this headline">#</a></h2>
<p>One of the problems with the Hanning window, is that if you have a short time series, you will end up using very little of the data at the edges of your time series due to the tapered window But, this data is just as important as the data in the center of the time series! This is not only a problem for short time series, but it can also, be a problem when you split your time series into smaller chunks to construct a continuous power spectrum and increase your degrees of freedom.</p>
<p>For example, we might want to split our time series into 2 chunks (see <a class="reference internal" href="#wosa"><span class="std std-ref">Figure 25</span></a> below). To reduce tapering at the edges, often one will apply the window to one chunk of data, and include a 50% overlap with that data when calculating the second chunk of data. In this case, you will have more than 2 chunks (you will have 3 chunks). It turns out that even though it may feel like you are double counting data, you actually gain 2 degrees of freedom per chunk (including those overlapping) if you are using a Hanning window. That is, if you use a 50% overlap with a Hanning window you will have 3 x 2 x 1.2 = 7.2 degrees of freedom per spectral estimate!</p>
<figure class="align-default" id="wosa">
<a class="reference internal image-reference" href="../../_images/WOSA.png"><img alt="../../_images/WOSA.png" src="../../_images/WOSA.png" style="width: 832.0px; height: 167.0px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 25 </span><span class="caption-text">Schematic of Welch’s Overlapping Segment Analysis (WOSA) Method for two chunks.</span><a class="headerlink" href="#wosa" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Let’s take a look at the python function <code class="docutils literal notranslate"><span class="pre">scipy.sig.welch</span></code> that we have used previously, now that we know a bit more about it and its connection to the issue of spectral leakage. We will use cosine wave time series with a bit of white noise to test the <code class="docutils literal notranslate"><span class="pre">sig.welch</span></code> function.</p>
<p>We are also going to divide the time series into 4 chunks, so you will see a new parameter below for the number of chunks. Use the “Live Code/Lauch Thebe” button to see how the power spectrum changes if you change the number of chunks. Try 1, 2 and 8 chunks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># input parameters</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">256</span>         <span class="c1">#length of time series</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>           <span class="c1">#number of chunks</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>     <span class="c1">#red noise lag-one autocorrelation</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1">#beta, red noise parameter</span>

<span class="n">T2</span> <span class="o">=</span> <span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">T2</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Calcalute the red noise spectrum:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># contstruct expected red noise spectrum </span>
<span class="n">rspec</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">rspec</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">alpha</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">/</span><span class="n">T2</span><span class="p">)</span><span class="o">+</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we will do the same procedure that we did in the last section, except that we will change the argument, <code class="docutils literal notranslate"><span class="pre">nperseg</span></code> in the <code class="docutils literal notranslate"><span class="pre">sig.welch</span></code> function to indicate the size of each chunk.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize array for zeros for synthetic time series</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">,)</span>

<span class="c1"># construct synthetic time series (note the f for the cosine wave is approximate 0.2)</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span>

<span class="c1"># compute power spectrum (try window = &quot;boxcar&quot; for comparison)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="s1">&#39;hanning&#39;</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">N</span><span class="p">))</span>
<span class="n">pave</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># normalize the spectrum</span>
<span class="n">pave</span> <span class="o">=</span> <span class="n">pave</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pave</span><span class="p">)</span>

<span class="c1"># calculate significance using F-test</span>
<span class="n">dof</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">*</span><span class="mf">1.2</span>
<span class="n">fstat</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">.99</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">spec99</span> <span class="o">=</span> <span class="p">[</span><span class="n">fstat</span><span class="o">*</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">rspec</span><span class="p">]</span>
    
<span class="n">fstat</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">.95</span><span class="p">,</span><span class="n">dof</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">spec95</span> <span class="o">=</span> <span class="p">[</span><span class="n">fstat</span><span class="o">*</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">rspec</span><span class="p">]</span>
    
<span class="c1"># plot power spectrum and red noise spectra</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (cycles per time step)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Normalized Power&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;# Chunks = 4&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">pave</span><span class="p">,</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">rspec</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rspec</span><span class="p">),</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;red-noise fit&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">spec99</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rspec</span><span class="p">),</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;99</span><span class="si">% c</span><span class="s1">onfidence&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">spec95</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rspec</span><span class="p">),</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;95</span><span class="si">% c</span><span class="s1">onfidence&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">File /opt/anaconda3/envs/ccia/lib/python3.10/site-packages/scipy/signal/windows/_windows.py:2214,</span> in <span class="ni">get_window</span><span class="nt">(window, Nx, fftbins)</span>
<span class="g g-Whitespace">   </span><span class="mi">2213</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2214</span>     <span class="n">beta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2215</span> <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="ne">ValueError</span>: could not convert string to float: &#39;hanning&#39;

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="nn">File /opt/anaconda3/envs/ccia/lib/python3.10/site-packages/scipy/signal/windows/_windows.py:2232,</span> in <span class="ni">get_window</span><span class="nt">(window, Nx, fftbins)</span>
<span class="g g-Whitespace">   </span><span class="mi">2231</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2232</span>     <span class="n">winfunc</span> <span class="o">=</span> <span class="n">_win_equiv</span><span class="p">[</span><span class="n">winstr</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">2233</span> <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="ne">KeyError</span>: &#39;hanning&#39;

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">line</span> <span class="mi">11</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="c1"># compute power spectrum (try window = &quot;boxcar&quot; for comparison)</span>
<span class="ne">---&gt; </span><span class="mi">11</span> <span class="n">p</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="s1">&#39;hanning&#39;</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">N</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">pave</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="c1"># normalize the spectrum</span>

<span class="nn">File /opt/anaconda3/envs/ccia/lib/python3.10/site-packages/scipy/signal/_spectral_py.py:446,</span> in <span class="ni">welch</span><span class="nt">(x, fs, window, nperseg, noverlap, nfft, detrend, return_onesided, scaling, axis, average)</span>
<span class="g g-Whitespace">    </span><span class="mi">289</span> <span class="k">def</span> <span class="nf">welch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;hann&#39;</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">noverlap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nfft</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">290</span>           <span class="n">detrend</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">return_onesided</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">291</span>           <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">292</span><span class="w">     </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">293</span><span class="sd">     Estimate power spectral density using Welch&#39;s method.</span>
<span class="g g-Whitespace">    </span><span class="mi">294</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">444</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">445</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">446</span>     <span class="n">freqs</span><span class="p">,</span> <span class="n">Pxx</span> <span class="o">=</span> <span class="n">csd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">nperseg</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">447</span>                      <span class="n">noverlap</span><span class="o">=</span><span class="n">noverlap</span><span class="p">,</span> <span class="n">nfft</span><span class="o">=</span><span class="n">nfft</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="n">detrend</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">448</span>                      <span class="n">return_onesided</span><span class="o">=</span><span class="n">return_onesided</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="n">scaling</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">449</span>                      <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="n">average</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">451</span>     <span class="k">return</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">Pxx</span><span class="o">.</span><span class="n">real</span>

<span class="nn">File /opt/anaconda3/envs/ccia/lib/python3.10/site-packages/scipy/signal/_spectral_py.py:580,</span> in <span class="ni">csd</span><span class="nt">(x, y, fs, window, nperseg, noverlap, nfft, detrend, return_onesided, scaling, axis, average)</span>
<span class="g g-Whitespace">    </span><span class="mi">454</span> <span class="k">def</span> <span class="nf">csd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s1">&#39;hann&#39;</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">noverlap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nfft</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">455</span>         <span class="n">detrend</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">return_onesided</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">456</span>         <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">457</span><span class="w">     </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">458</span><span class="sd">     Estimate the cross power spectral density, Pxy, using Welch&#39;s method.</span>
<span class="g g-Whitespace">    </span><span class="mi">459</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">578</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">579</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">580</span>     <span class="n">freqs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">Pxy</span> <span class="o">=</span> <span class="n">_spectral_helper</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">,</span> <span class="n">noverlap</span><span class="p">,</span> <span class="n">nfft</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">581</span>                                      <span class="n">detrend</span><span class="p">,</span> <span class="n">return_onesided</span><span class="p">,</span> <span class="n">scaling</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">582</span>                                      <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;psd&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>     <span class="c1"># Average over windows.</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Pxy</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">Pxy</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

<span class="nn">File /opt/anaconda3/envs/ccia/lib/python3.10/site-packages/scipy/signal/_spectral_py.py:1780,</span> in <span class="ni">_spectral_helper</span><span class="nt">(x, y, fs, window, nperseg, noverlap, nfft, detrend, return_onesided, scaling, axis, mode, boundary, padded)</span>
<span class="g g-Whitespace">   </span><span class="mi">1777</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;nperseg must be a positive integer&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1779</span> <span class="c1"># parse window; if array like, then set nperseg = win.shape</span>
<span class="ne">-&gt; </span><span class="mi">1780</span> <span class="n">win</span><span class="p">,</span> <span class="n">nperseg</span> <span class="o">=</span> <span class="n">_triage_segments</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">,</span> <span class="n">input_length</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="g g-Whitespace">   </span><span class="mi">1782</span> <span class="k">if</span> <span class="n">nfft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1783</span>     <span class="n">nfft</span> <span class="o">=</span> <span class="n">nperseg</span>

<span class="nn">File /opt/anaconda3/envs/ccia/lib/python3.10/site-packages/scipy/signal/_spectral_py.py:2003,</span> in <span class="ni">_triage_segments</span><span class="nt">(window, nperseg, input_length)</span>
<span class="g g-Whitespace">   </span><span class="mi">1999</span>         <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;nperseg = </span><span class="si">{0:d}</span><span class="s1"> is greater than input length &#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">2000</span>                       <span class="s1">&#39; = </span><span class="si">{1:d}</span><span class="s1">, using nperseg = </span><span class="si">{1:d}</span><span class="s1">&#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">2001</span>                       <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nperseg</span><span class="p">,</span> <span class="n">input_length</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">2002</span>         <span class="n">nperseg</span> <span class="o">=</span> <span class="n">input_length</span>
<span class="ne">-&gt; </span><span class="mi">2003</span>     <span class="n">win</span> <span class="o">=</span> <span class="n">get_window</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">nperseg</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2004</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2005</span>     <span class="n">win</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

<span class="nn">File /opt/anaconda3/envs/ccia/lib/python3.10/site-packages/scipy/signal/windows/_windows.py:2234,</span> in <span class="ni">get_window</span><span class="nt">(window, Nx, fftbins)</span>
<span class="g g-Whitespace">   </span><span class="mi">2232</span>     <span class="n">winfunc</span> <span class="o">=</span> <span class="n">_win_equiv</span><span class="p">[</span><span class="n">winstr</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">2233</span> <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2234</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown window type.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
<span class="g g-Whitespace">   </span><span class="mi">2236</span> <span class="k">if</span> <span class="n">winfunc</span> <span class="ow">is</span> <span class="n">dpss</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2237</span>     <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">Nx</span><span class="p">,)</span> <span class="o">+</span> <span class="n">args</span> <span class="o">+</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span>

<span class="ne">ValueError</span>: Unknown window type.
</pre></div>
</div>
</div>
</div>
<p>You should notice that the spectral peak gets wider as we increase the number of chunks. This is because we are losing information as the time segments get shorter; however, the WOSA method is still able to identify the correct frequency for the peak and as we increase the number of chunks, the peak corresponding to the periodic frequency in our data emerges as the only significant one - reducing spectral leakage.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "kls2177/Climate-and-Geophysical-Data-Analysis",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters/Week6"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="filtering_in_freq3.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Continuous Power Spectrum and the Significance of Spectral Peaks</p>
      </div>
    </a>
    <a class="right-next"
       href="convolution_filters_in_time.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Convolution and Filtering in the Time Domain</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-up-the-problem">Setting up the problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#convolution">Convolution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#response-functions">Response Functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#characteristics-of-the-boxcar-window-response-function">Characteristics of the Boxcar Window Response Function:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#alternative-windows-for-minimizing-spectral-leakage">Alternative Windows for Minimizing Spectral Leakage</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#windows-and-degress-of-freedom">Windows and Degress of Freedom</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#welch-s-overlapping-segment-analysis-method">Welch’s Overlapping Segment Analysis Method</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Karen Smith
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>